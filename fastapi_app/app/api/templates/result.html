<!DOCTYPE html>
<html>
<head>
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .message { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .text-container {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            max-height: 300px;
            overflow-y: auto;
        }
        .back-btn {
            display: inline-block; margin-top: 20px; padding: 10px 20px;
            background: #6c757d; color: white; text-decoration: none; border-radius: 4px;
        }
        .back-btn:hover { background: #545b62; }
        .task-info {
            padding: 10px;
            background: #e7f3ff;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üì® –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏</h1>

    {% if success %}
        <div class="message success">
            <h3>‚úÖ –ö–∞–π—Ñ</h3>
            <p>{{ message }}</p>

            {% if task_id %}
            <div class="task-info">
                <strong>üîÑ –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:</strong> 
                <span id="task-status">–ó–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ</span>
                <br>
                <strong>ID –∑–∞–¥–∞—á–∏:</strong> {{ task_id }}
            </div>
            {% endif %}

            <div class="text-container">
                <strong>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong>
                <p>{{ extracted_text | safe }}</p>
            </div>

            <p><strong>ID:</strong> {{ item_id }}</p>
            <p><strong>Email:</strong> {{ email_to }}</p>
            
            {% if image_included %}
            <p><strong>üìé –ö–∞—Ä—Ç–∏–Ω–∫–∞:</strong> –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–ª–æ–∂–µ–Ω–∏–µ–º</p>
            {% else %}
            <p><strong>üìé –ö–∞—Ä—Ç–∏–Ω–∫–∞:</strong> –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å</p>
            {% endif %}
        </div>

        {% if task_id %}
        <script>
        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
        function checkTaskStatus() {
            fetch('/api/v1/emails/task-status/{{ task_id }}')
                .then(response => response.json())
                .then(data => {
                    const statusElement = document.getElementById('task-status');
                    if (data.status === 'SUCCESS') {
                        statusElement.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ';
                        statusElement.style.color = 'green';
                    } else if (data.status === 'FAILURE') {
                        statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏';
                        statusElement.style.color = 'red';
                        if (data.result && data.result.message) {
                            statusElement.innerHTML += ': ' + data.result.message;
                        }
                    } else {
                        statusElement.innerHTML = 'üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ...';
                        setTimeout(checkTaskStatus, 2000);
                    }
                })
                .catch(error => {
                    console.error('Error checking task status:', error);
                });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞
        checkTaskStatus();
        </script>
        {% endif %}

    {% else %}
        <div class="message error">
            <h3>‚ùå –û—à–∏–±–∫–∞!</h3>
            <p>{{ error }}</p>
        </div>
    {% endif %}

    <a href="/api/v1/emails/form" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ</a>
</body>
</html>